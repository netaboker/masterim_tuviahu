<script>
    /**
     * כאן את מדביקה את הקישור שהעתקת מה-Firebase.
     * וודאי שהסיומת היא requests.json
     */
    const FIREBASE_URL = "https://masterim-92c84-default-rtdb.europe-west1.firebasedatabase.app/requests.json";

    function showPage(pageId) {
        // הסרת מחלקת active מכל העמודים
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        // הוספת active לעמוד הנבחר
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.add('active');
            
            // עדכון ה-URL עם ה-ID של העמוד (למשל #publish-page)
            if (window.location.hash !== '#' + pageId) {
                window.location.hash = pageId;
            }
        }
        
        // אם זה עמוד הבקשות, נטען נתונים
        if (pageId === 'requests-page') {
            fetchRequests();
        }
    }

    // האזנה לשינויים ב-URL (למשל כשלוחצים "אחורה" בדפדפן)
    window.addEventListener('hashchange', () => {
        const pageId = window.location.hash.replace('#', '');
        if (pageId) {
            showPage(pageId);
        } else {
            showPage('welcome-page'); // ברירת מחדל
        }
    });

    // בדיקה בטעינה ראשונית של הדף
    window.addEventListener('load', () => {
        const pageId = window.location.hash.replace('#', '');
        if (pageId && document.getElementById(pageId)) {
            showPage(pageId);
        }
    });

    // שליחה לענן (POST)
    document.getElementById('request-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitBtn = document.getElementById('submit-btn');
        
        const data = {
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            timestamp: new Date().toLocaleString('he-IL')
        };

        submitBtn.disabled = true;
        submitBtn.innerText = "שולח...";

        try {
            const response = await fetch(FIREBASE_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('הבקשה נשמרה בהצלחה בענן!');
                document.getElementById('request-form').reset();
                showPage('requests-page');
            } else {
                throw new Error('Response not OK');
            }
        } catch (error) {
            console.error(error);
            alert('שגיאה: וודאי שהקישור תקין ושהגדרת Rules ב-Firebase ל-true.');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "שלח בקשה לענן";
        }
    });

    // משיכה מהענן (GET)
    async function fetchRequests() {
        const container = document.getElementById('requests-container');
        
        try {
            const response = await fetch(FIREBASE_URL);
            const data = await response.json();
            
            if (!data) {
                container.innerHTML = "<p class='text-gray-500 text-center'>אין בקשות כרגע.</p>";
                return;
            }

            container.innerHTML = Object.values(data).reverse().map(req => `
                <div class="bg-white p-6 rounded-2xl shadow-md border-r-8 border-blue-600">
                    <h3 class="text-xl font-bold text-blue-900 mb-2">${req.title}</h3>
                    <p class="text-gray-700 mb-4">${req.content}</p>
                    <div class="text-xs text-gray-400 font-mono">${req.timestamp}</div>
                </div>
            `).join('');

        } catch (error) {
            container.innerHTML = "<p class='text-red-500 text-center'>שגיאה בטעינת הנתונים.</p>";
        }
    }
</script>
