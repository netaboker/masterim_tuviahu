<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>住专 砖  - 专住转 </title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --dark: #0f172a;
            --bg: #f8fafc;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        body {
            font-family: 'Assistant', sans-serif;
            margin: 0;
            background-color: var(--primary);
            color: var(--dark);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Login Screen --- */
        #login-screen {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 30px;
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 25px rgba(0,0,0,0.1);
        }

        input, select, textarea { 
            width: 100%; padding: 14px; border: 1px solid var(--light-gray); 
            border-radius: 12px; font-family: inherit; box-sizing: border-box; 
            margin-top: 8px; font-size: 16px; /* 注   驻 */
        }

        /* --- Layout & Header --- */
        #app { display: none; background: var(--bg); min-height: 100vh; }

        header {
            background: white;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid var(--light-gray);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding-bottom: 10px;
        }

        .logo-area { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .logo-area h2 { font-size: 1.2rem; margin: 0; }

        /* --- Navigation --- */
        nav { 
            display: flex; 
            gap: 15px; 
            overflow-x: auto; 
            width: 100%;
            padding-bottom: 5px;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        nav::-webkit-scrollbar { display: none; } /* Hide scrollbar Chrome */

        nav a { 
            text-decoration: none; 
            color: var(--gray); 
            font-weight: 600; 
            white-space: nowrap;
            font-size: 0.95rem;
            padding: 8px 5px;
        }
        nav a.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

        /* --- Logout Button UI --- */
        .logout-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg);
            padding: 5px 12px;
            border-radius: 50px;
        }

        .btn-logout-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: #fee2e2;
            color: var(--danger);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            transition: 0.2s;
        }
        .btn-logout-icon:hover { background: var(--danger); color: white; }

        /* --- Grid & Content --- */
        .content-area { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .page { display: none; }
        .page.active { display: block; }

        .hero {
            background: linear-gradient(135deg, var(--primary), #6366f1);
            border-radius: 20px; padding: 30px 20px; color: white; margin-bottom: 25px;
        }
        .hero h2 { margin-top: 0; font-size: 1.5rem; }

        .request-grid { 
            display: grid; 
            grid-template-columns: 1fr; /* 专专转  注 转  */
            gap: 15px; 
        }

        /*  砖 */
        @media (min-width: 768px) {
            header { flex-direction: row; padding: 15px 50px; }
            .header-top { width: auto; padding: 0; }
            nav { width: auto; gap: 30px; overflow: visible; }
            .request-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
            .hero { padding: 50px; }
            .hero h2 { font-size: 2.2rem; }
        }

        .card { background: white; padding: 20px; border-radius: 18px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); border: 1px solid #f0f0f0; }
        
        .btn { 
            padding: 14px 20px; border-radius: 12px; border: none; font-weight: bold; 
            cursor: pointer; transition: 0.2s; font-family: inherit; width: 100%;
        }
        .btn-dark { background: var(--dark); color: white; }
        .btn-primary { background: var(--primary); color: white; }

        /* Modal */
        .modal {
            display: none; position: fixed; z-index: 1001;
            left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); align-items: flex-end; /* 驻转   */
        }
        .modal-content { 
            background: white; padding: 25px; border-radius: 20px 20px 0 0; 
            width: 100%; box-sizing: border-box; 
        }

        @media (min-width: 768px) {
            .modal { align-items: center; }
            .modal-content { border-radius: 24px; width: 400px; }
        }

    </style>
</head>
<body onload="checkLoginStatus()">

    <div id="volunteer-modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0"> 专爪 注专! </h3>
            <p id="modal-req-title" style="font-weight: bold; color: var(--primary);"></p>
            <input type="text" id="vol-name" placeholder="砖  砖">
            <input type="text" id="vol-class" placeholder="转">
            <textarea id="vol-availability" rows="2" placeholder="转   注专?"></textarea>
            <button class="btn btn-primary" style="margin-top:15px" onclick="submitVolunteer()">砖转 爪注</button>
            <button class="btn" style="background:none; color:var(--gray)" onclick="closeModal()"></button>
        </div>
    </div>

    <section id="login-screen">
        <div class="login-card">
            <div style="font-size: 60px;"></div>
            <h1 style="margin: 10px 0;">住专 砖 </h1>
            <p style="color: var(--gray)">拽转 注专转 转 住驻专转</p>
            <div style="margin: 25px 0; text-align: right;">
                <label style="font-weight: 600;"></label>
                <input type="email" id="userEmail" placeholder="name@school.edu.il">
            </div>
            <button class="btn btn-dark" onclick="initApp()">住 注专转</button>
        </div>
    </section>

    <div id="app">
        <header>
            <div class="header-top">
                <div class="logo-area" onclick="showPage('dashboard')">
                    <span style="font-size: 22px;"></span>
                    <h2>住专</h2>
                </div>
                <div class="logout-wrapper">
                    <span id="display-name" style="font-weight: 700; font-size: 0.9rem;"></span>
                    <button class="btn-logout-icon" onclick="handleLogout()" title="转转拽转">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"></path></svg>
                    </button>
                </div>
            </div>
            <nav>
                <a onclick="showPage('dashboard')" id="nav-dashboard" class="active"> 拽砖转</a>
                <a onclick="showPage('new-request')" id="nav-new-request">拽砖 砖</a>
                <a onclick="showPage('admin')" id="nav-admin" class="admin-link"></a>
            </nav>
        </header>

        <div class="content-area">
            <div id="page-dashboard" class="page active">
                <div class="hero">
                    <h2> 拽砖转 砖 </h2>
                    <p>爪 转 注专 专  砖 爪转.</p>
                </div>
                <div id="main-grid" class="request-grid"></div>
            </div>

            <div id="page-new-request" class="page">
                <div class="card" style="max-width: 550px; margin: 0 auto;">
                    <h2 style="margin-top:0">驻专住 拽砖</h2>
                    <div style="text-align: right;">
                        <label>砖 </label><input type="text" id="req-name">
                        <label>转</label><input type="text" id="req-class">
                        <label>转专转</label><input type="text" id="req-title" placeholder="砖: 注专 转专">
                        <label>转专</label><textarea id="req-desc" rows="3"></textarea>
                        <button class="btn btn-primary" style="margin-top:15px" onclick="publishRequest()">驻专住 注砖</button>
                    </div>
                </div>
            </div>

            <div id="page-admin" class="page">
                <div class="card">
                    <h2> 砖专</h2>
                    <div id="admin-approvals"></div>
                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--light-gray);">
                    <button class="btn btn-dark" onclick="generateSourceCode()">爪 拽 -GitHub</button>
                    <textarea id="code-exporter" readonly style="height:60px; font-size:10px;"></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        let requests = [];
        let pendingVolunteers = [];
        let currentActiveRequestId = null;

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('schoolMasterUser');
            if (savedUser) loginSuccess(savedUser);
        }

        function initApp() {
            const email = document.getElementById('userEmail').value;
            if (email.includes('@')) {
                localStorage.setItem('schoolMasterUser', email);
                loginSuccess(email);
            } else { alert("  转拽"); }
        }

        function loginSuccess(email) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('display-name').innerText = email.split('@')[0];
            document.body.style.backgroundColor = 'var(--bg)';
            showPage('dashboard');
            renderDashboard();
        }

        function handleLogout() {
            if (confirm(" 专爪 爪转 注专转?")) {
                localStorage.removeItem('schoolMasterUser');
                location.reload();
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            const navLink = document.getElementById('nav-' + pageId);
            if (navLink) navLink.classList.add('active');
            if(pageId === 'admin') renderAdmin();
            window.scrollTo(0,0);
        }

        function publishRequest() {
            const req = {
                id: Date.now(),
                name: document.getElementById('req-name').value,
                className: document.getElementById('req-class').value,
                title: document.getElementById('req-title').value,
                desc: document.getElementById('req-desc').value,
                status: '转 注专'
            };
            if(!req.title || !req.desc) return alert(" 驻专");
            requests.unshift(req);
            showPage('dashboard');
            renderDashboard();
        }

        function renderDashboard() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = requests.length === 0 ? 
                '<div style="text-align:center; padding:40px; color:var(--gray)"> 拽砖转 驻注转 专注. 转 专砖 驻专住!</div>' : 
                requests.map(req => `
                <div class="card">
                    <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">转: ${req.name} (转 ${req.className})</div>
                    <div style="display:inline-block; padding:3px 8px; border-radius:6px; font-size:0.7rem; font-weight:800; margin-bottom:10px; ${req.status === '转 注专' ? 'background:#fef3c7; color:#92400e;' : 'background:#dcfce7; color:#166534;'}">${req.status}</div>
                    <h3 style="margin:0 0 10px 0;">${req.title}</h3>
                    <p style="font-size:0.9rem; color:var(--gray); margin-bottom:15px;">${req.desc}</p>
                    <button class="btn btn-dark" onclick="openVolunteerModal(${req.id}, '${req.title}')"> 专爪 注专</button>
                </div>
            `).join('');
        }

        function openVolunteerModal(id, title) {
            currentActiveRequestId = id;
            document.getElementById('modal-req-title').innerText = title;
            document.getElementById('volunteer-modal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('volunteer-modal').style.display = 'none'; }

        function submitVolunteer() {
            const req = requests.find(r => r.id === currentActiveRequestId);
            req.status = "驻 转";
            pendingVolunteers.push({reqId: req.id, volName: document.getElementById('vol-name').value});
            closeModal();
            renderDashboard();
        }

        function renderAdmin() {
            const adminDiv = document.getElementById('admin-approvals');
            adminDiv.innerHTML = pendingVolunteers.length === 0 ? '<p> 拽砖转 转转 砖专 专注.</p>' : pendingVolunteers.map((v, i) => `
                <div class="card" style="margin-bottom:10px; border-right: 4px solid var(--primary)">
                    <div style="font-size:0.85rem"><strong>${v.volName}</strong> 专爪 注专 拽砖:</div>
                    <div style="font-weight:bold; margin:5px 0">${requests.find(r => r.id === v.reqId)?.title}</div>
                    <button class="btn btn-primary" style="padding:8px" onclick="pendingVolunteers.splice(${i},1);renderAdmin()">砖专 抓'</button>
                </div>
            `).join('');
        }

        function generateSourceCode() {
            document.getElementById('code-exporter').value = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
        }
    </script>
</body>
</html>
